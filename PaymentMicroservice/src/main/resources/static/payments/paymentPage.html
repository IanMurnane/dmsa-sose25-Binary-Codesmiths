<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment Service Demo</title>
    <link rel="stylesheet" href="payment-style.css">
</head>
<body>

<h1>Payment Service Frontend</h1>

<div class="card">
    <h2>Process New Payment</h2>
    <form id="paymentForm">
        <label for="bookingId">Booking ID</label>
        <input type="text" id="bookingId" name="bookingId" required>

        <label for="userId">User ID</label>
        <input type="text" id="userId" name="userId" required>

        <label for="amount">Amount</label>
        <input type="number" step="0.01" id="amount" name="amount" required>

        <label for="paymentMethod">Payment Method</label>
        <select id="paymentMethod" name="paymentMethod" required>
            <option value="credit_card">Credit Card</option>
            <option value="paypal">PayPal</option>
        </select>

        <button type="submit">Submit Payment</button>
    </form>
    <div id="paymentResult" class="result" style="display:none"></div>
    <div id="paymentError" class="error" style="display:none"></div>
</div>

<div class="divider"></div>

<div class="card">
    <h2>Get Payment Status by Booking</h2>
    <form id="getStatusForm">
        <label for="lookupBookingId">Booking ID</label>
        <input type="text" id="lookupBookingId" name="lookupBookingId" required>
        <button type="submit">Get Status</button>
    </form>
    <div id="statusResult" class="result" style="display:none"></div>
    <div id="statusError" class="error" style="display:none"></div>
</div>

<script>
    // You can adjust this URL as needed
    const BASE_URL = "/"; // For relative calls, works if frontend served by backend

    document.getElementById('paymentForm').onsubmit = async function (e) {
        e.preventDefault();
        const bookingId = document.getElementById('bookingId').value;
        const userId = document.getElementById('userId').value;
        const amount = document.getElementById('amount').value;
        const paymentMethod = document.getElementById('paymentMethod').value;

        const payload = { bookingId, userId, amount: parseFloat(amount), paymentMethod };

        try {
            const res = await fetch(`${BASE_URL}payments`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });
            const data = await res.json();
            if (res.ok) {
                document.getElementById('paymentResult').style.display = "block";
                document.getElementById('paymentResult').textContent = "Payment Successful! Response: " + JSON.stringify(data, null, 2);
                document.getElementById('paymentError').style.display = "none";
            } else {
                throw new Error(data.message || "Payment failed");
            }
        } catch (err) {
            document.getElementById('paymentResult').style.display = "none";
            document.getElementById('paymentError').style.display = "block";
            document.getElementById('paymentError').textContent = "Error: " + err.message;
        }
    };

    document.getElementById('getStatusForm').onsubmit = async function (e) {
        e.preventDefault();
        const bookingId = document.getElementById('lookupBookingId').value;
        try {
            const res = await fetch(`${BASE_URL}payments/booking/${bookingId}`);
            const data = await res.json();
            if (res.ok) {
                document.getElementById('statusResult').style.display = "block";
                document.getElementById('statusResult').textContent = "Payment Info: " + JSON.stringify(data, null, 2);
                document.getElementById('statusError').style.display = "none";
            } else {
                throw new Error(data.message || "Not found");
            }
        } catch (err) {
            document.getElementById('statusResult').style.display = "none";
            document.getElementById('statusError').style.display = "block";
            document.getElementById('statusError').textContent = "Error: " + err.message;
        }
    };
</script>
</body>
</html>
